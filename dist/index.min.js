!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.noreact=e():t.noreact=e()}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s="./src/index.ts")}({"./src/MVVM.ts":function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=r("./src/diff.ts"),i=r("./src/event-center.ts"),s=r("./src/VNode.ts"),a=n(r("./src/react.ts")),u=r("./src/refresh.ts"),c=function(){function t(t){this.$eventRegister={},this.$children=[],this.$isdirty=!1,this.$refs={},this.hasRenderedDom=!1,"[object Object]"==toString.call(t)&&(this.$props=t,this.watchObject(this.$props))}return t.prototype.onInit=function(){},t.prototype.onRendered=function(){},t.prototype.onDestroyed=function(){},t.prototype.$emitUp=function(t,e){this.$root.EmitUp(t,e,this)},t.prototype.$emitDown=function(t,e){this.$root.EmitDown(t,e,this)},t.prototype.$on=function(t,e){this.$eventRegister[t]||(this.$eventRegister[t]=[]),this.$eventRegister[t].push(e),i.RegisterEvent(t,e)},t.prototype.$broadcast=function(t,e){i.TriggerEvent(t,this,e)},t.prototype.$Trigger=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.$eventRegister[t];n&&n.forEach(function(t){return t.apply(void 0,e)})},t.prototype.$ToDom=function(){this.hasRenderedDom=!0,this.$root||this.$DoRender();var t=this.$root.ToDom();return this.$attachedVNode.SetDom(t),t},t.prototype.$ToHtml=function(){return this.Render().ToHtml()},t.prototype.$GetRoot=function(){return this.$root||this.$DoRender(),this.$root},t.prototype.$SetChildren=function(t){this.$children=t},t.prototype.$Dirty=function(){this.$isdirty||(this.$isdirty=!0,u.InsertQueue(this))},t.prototype.$ApplyRefresh=function(){if(this.$isdirty){a.default.ChangeMode("shallow");var t=a.default.target;a.default.target=this;var e=this.Render();a.default.target=t,a.default.ChangeMode("deep"),this.$diff([this.$root],[e],this.$root.GetParent()),this.$isdirty=!1}},t.prototype.$Ref=function(t){var e=this.$refs[t];if(e&&!e.IsDestroyed())return e.GetInstance()?e.GetInstance():e.GetDom()&&e.GetDom()[0];var r=this.$root.GetRef(t);return r?(this.$refs[t]=r,r.GetInstance()?r.GetInstance():e.GetDom()&&r.GetDom()[0]):null},t.prototype.$DoRender=function(){this.onInit();var t=[];Object.keys(this).forEach(function(e){e.startsWith("$")||t.push(e)}),t.length>0&&this.watchObject(this,t);var e=a.default.target;return a.default.target=this,this.$root=this.Render(),this.$attachedVNode||(this.$attachedVNode=new s.VNode("custom"),this.$attachedVNode.SetMvvm(this)),this.$root.SetParent(this.$attachedVNode),a.default.target=e,this.$root},t.prototype.watchObject=function(t,e){var r=this;if("[object Object]"!=toString.call(t)&&"[object Array]"!=toString.call(t));else{var n=[];(e&&e.length>0&&e||Object.keys(t)).forEach(function(e){var o=Object.getOwnPropertyDescriptor(t,e);if(o&&o.configurable){var i=t[e];Object.defineProperty(t,e,{get:function(){return a.default.target&&n.indexOf(a.default.target)&&n.push(a.default.target),i},set:function(t){t!=i&&(n.forEach(function(t){return t.$Dirty()}),i=t,"[object Array]"==toString.call(i)&&r.watchArray(i,n),r.watchObject(i))},configurable:!1,enumerable:!0}),"[object Array]"==toString.call(i)&&r.watchArray(i,n),r.watchObject(i)}})}},t.prototype.watchArray=function(t,e){this.overwriteArrayMethods(t,"pop",e),this.overwriteArrayMethods(t,"push",e),this.overwriteArrayMethods(t,"splice",e),this.overwriteArrayMethods(t,"unshift",e),this.overwriteArrayMethods(t,"shift",e)},t.prototype.overwriteArrayMethods=function(t,e,r){var n=t[e];"function"==typeof n&&Object.defineProperty(t,e,{value:function(){return r.forEach(function(t){return t.$Dirty()}),n.apply(this,arguments)},configurable:!1})},t.prototype.useOld=function(t,e){if("custom"!=t.GetType()){if("standard"==t.GetType())return t.ApplyAttrDiff(e.GetAttrs()),void this.$diff(t.GetChildren(),e.GetChildren(),t);t.GetType()}else{var r=t.GetInstance(),n=e.GetInstance();r.$isdirty?(r.$props=n.$props,r.watchObject(r.$props),r.$ApplyRefresh()):Object.assign(r.$props,n.$props)}},t.prototype.$diff=function(e,r,n){var i=this,s=o.Diff(e,r,t.$compareVNode),a=0;s.forEach(function(t){return"old"==t.state?(a++,void i.useOld(t.oldValue,t.newValue)):"new"==t.state?(t.newValueOrigin?(i.useOld(t.newValueOrigin,t.newValue),n.InsertVNode(t.newValueOrigin,a)):(i.hasRenderedDom&&t.newValue.ToDom(),n.InsertVNode(t.newValue,a),i.hasRenderedDom&&t.newValue.Rendered()),void a++):"delete"==t.state?(n.RemoveVNode(t.oldValue,a,t.isdeprecated),void(t.isdeprecated&&t.oldValue.Destroy())):void("replace"==t.state&&(n.RemoveVNode(t.oldValue,a,t.isdeprecated),t.isdeprecated&&t.oldValue.Destroy(),t.newValueOrigin?(i.useOld(t.newValueOrigin,t.newValue),n.InsertVNode(t.newValueOrigin,a)):(i.hasRenderedDom&&t.newValue.ToDom(),n.InsertVNode(t.newValue,a),i.hasRenderedDom&&t.newValue.Rendered()),a++))})},t.prototype.$Rendered=function(){this.$root.Rendered(),this.onRendered()},t.prototype.$Destroy=function(){this.onDestroyed(),this.$root.Destroy()},t.prototype.$AttachVNode=function(t){this.$attachedVNode=t},t.$compareVNode=function(t,e){return t.GetAttr("key")==e.GetAttr("key")&&(t.GetType()==e.GetType()&&(("custom"!=t.GetType()||t.GetInstance().constructor==e.GetInstance().constructor)&&(("standard"!=t.GetType()||t.GetTag()==e.GetTag())&&("text"!=t.GetType()||t.GetText()==e.GetText()))))},t}();e.MVVM=c},"./src/VNode.ts":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r("./src/attribute.ts"),o=function(){function t(t){this.tag="",this.text="",this.children=[],this.attrs={},this.parent=null,this.isDestroyed=!1,this.type=t}return t.prototype.SetTag=function(t){this.tag=t},t.prototype.GetTag=function(){return this.tag},t.prototype.GetText=function(){return this.text},t.prototype.SetText=function(t){this.text=t},t.prototype.SetMvvm=function(t){this.mvvm=t},t.prototype.GetInstance=function(){return this.mvvm},t.prototype.GetParent=function(){return this.parent},t.prototype.InsertVNode=function(t,e){var r=t.GetDom();if(r&&r.length>0){for(var n=null;this.children[e];){var o=this.children[e].GetDom();if(o.length>0){n=o[0];break}e++}if(n)r.forEach(function(t){n.parentNode.insertBefore(t,n)});else{var i=this.doms.length>1?this.doms[0].parentNode:this.doms[0];r.forEach(function(t){i.appendChild(t)})}}this.children.splice(e,0,t),t.parent=this},t.prototype.AppendChild=function(t){t.parent=this,this.children.push(t)},t.prototype.RemoveVNode=function(t,e,r){if(void 0===r&&(r=!0),this.children.splice(e,1),r){var n=t.GetDom();n&&n.forEach(function(t){t.parentNode.removeChild(t)})}},t.prototype.IsDestroyed=function(){return this.isDestroyed},t.prototype.Destroy=function(){this.isDestroyed=!0,"custom"==this.type&&this.mvvm.$Destroy(),this.children.forEach(function(t){t.Destroy()})},t.prototype.GetChildren=function(){return this.children},t.prototype.Rendered=function(){"custom"==this.type&&this.mvvm.$Rendered(),"standard"==this.type&&this.children.forEach(function(t){t.Rendered()})},t.prototype.GetDom=function(){return this.doms},t.prototype.GetRef=function(t){if(this.attrs.ref)return this;if("custom"!=this.type)for(var e=0;e<this.children.length;e++){var r=this.children[e].GetRef(t);if(r)return r}return null},t.prototype.GetType=function(){return this.type},t.prototype.SetAttr=function(t,e){this.attrs[t]=e},t.prototype.GetAttr=function(t){return this.attrs[t]},t.prototype.GetAttrs=function(){return this.attrs},t.prototype.SetParent=function(t){this.parent=t},t.prototype.ApplyAttrDiff=function(t){var e=this;Object.keys(this.attrs).forEach(function(r){var o=n.GetEventAttrName(r),i=null!=o;if(null==t[r])i?e.doms[0].removeEventListener(o,e.attrs[r]):n.RemoveAttr(e.doms[0],r,e.attrs[r]);else{if("style"==r&&"[object Object]"==toString.call(e.attrs.style)&&"[object Object]"==toString.call(t.style)){var s=e.attrs.style,a=t.style;for(var u in s)a[u]?a[u]!=s[u]&&(e.doms[0].style[u]=a[u]):e.doms[0].style[u]="";for(var c in a)s[c]||(e.doms[0].style[c]=a[c]);return}i?e.attrs[r]!=t[r]&&(e.doms[0].removeEventListener(o,e.attrs[r]),e.doms[0].addEventListener(o,t[r])):e.attrs[r]!=t[r]&&(n.RemoveAttr(e.doms[0],r,e.attrs[r]),n.ApplyAttr(e.doms[0],r,t[r]))}}),Object.keys(t).forEach(function(r){var o=n.GetEventAttrName(r),i=null!=o;null==e.attrs[r]&&(i?e.doms[0].addEventListener(o,t[r]):n.ApplyAttr(e.doms[0],r,t[r]))}),this.attrs=t},t.prototype.ToHtml=function(){var t=this;if("text"==this.type)return this.text;if("custom"==this.type)return this.mvvm.$ToHtml();if("standard"==this.type){var e=[];return"fragment"!=this.tag&&(e.push("<"+this.tag),Object.keys(this.attrs).forEach(function(r){var o=n.SerializeAttr(r,t.attrs[r]);o&&e.push(" "+o)}),e.push(">")),this.children.forEach(function(t){var r=t.ToHtml();e.push(r)}),"fragment"!=this.tag&&e.push("</"+this.tag+">"),e.join("")}},t.prototype.ToDom=function(){var t=this;if("undefined"==typeof document)return null;if("custom"==this.type){var e=this.mvvm.$ToDom();return this.doms=e,e}if("standard"==this.type){if("fragment"!=this.tag){var r=document.createElement(this.tag);return this.doms=[r],Object.keys(this.attrs).forEach(function(e){var o=n.GetEventAttrName(e);o?r.addEventListener(o,t.attrs[e]):n.ApplyAttr(r,e,t.attrs[e])}),this.children.forEach(function(t){t.ToDom().forEach(function(t){return r.appendChild(t)})}),[r]}var o=[];return this.children.forEach(function(t){var e=t.ToDom();o=o.concat(e)}),this.doms=o,o}if("text"==this.type){var i=document.createTextNode(this.text);return this.doms=[i],[i]}},t.prototype.EmitUp=function(t){for(var e,r,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];this.parent&&("custom"==this.parent.type&&(e=this.parent.mvvm).$Trigger.apply(e,[t].concat(n)),(r=this.parent).EmitUp.apply(r,[t].concat(n)))},t.prototype.EmitDown=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.children.forEach(function(r){var n;"custom"==r.type&&(n=r.mvvm).$Trigger.apply(n,[t].concat(e)),r.EmitDown.apply(r,[t].concat(e))})},t.prototype.AttachDom=function(t){var e=this;this.doms=[t],Object.keys(this.attrs).forEach(function(r){var o=n.GetEventAttrName(r);o&&t.addEventListener(o,e.attrs[r])})},t.prototype.SetDom=function(t){this.doms=t},t}();e.VNode=o},"./src/attribute.ts":function(t,e,r){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.VNODE_ID="__decorator__";var o=!1;e.ServerRender=function(t){o=t};var i={style:function(t,e){if("[object Object]"==toString.call(e)){for(var r in e)t.style[r]=e[r];return!0}return!1},className:function(t,e){return t.setAttribute("class",e),!0},key:function(t,e){return!0},value:function(t,e){return t instanceof HTMLInputElement&&(t.value=e,!0)}},s={style:function(t,e){if("[object Object]"==toString.call(e)){for(var r in e)t.style[r]="";return!0}return!1},className:function(t,e){return t.setAttribute("class",""),!0},key:function(t,e){return!0},value:function(t,e){return t instanceof HTMLInputElement&&(t.value="",!0)}},a=((n={style:function(t){if("[object Object]"==toString.call(t)){var e="";for(var r in t)e+=r+"="+t[r]+";";return'style="'+e+'"'}return"style="+t},className:function(t){return"class="+t},key:function(t){return""}})[e.VNODE_ID]=function(t){return o?e.VNODE_ID+"="+t:""},n);e.SerializeAttr=function(t,e){return"[object Function]"==toString.call(e)?"":a[t]?a[t](e):t+"="+e},e.ApplyAttr=function(t,e,r){if(i[e]&&i[e](t,r))return;t.setAttribute(e,r)},e.RemoveAttr=function(t,e,r){if(s[e]&&s[e](t,r))return;t.setAttribute(e,"")},e.GetEventAttrName=function(t){return/^on([A-Z][a-z]+)+$/.test(t)?t.slice(2).toLowerCase():null}},"./src/diff.ts":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Diff=function(t,e,r){var n={},o={},i=function(t,e){for(var r=[],n=0;n<=t.length;n++){for(var o=[],i=0;i<=e.length;i++)0!=n?0!=i?o.push({value:-1,fromRow:-1,fromColumn:-1}):o.push({value:n,fromRow:n-1,fromColumn:0}):o.push({value:i,fromRow:0,fromColumn:i-1});r.push(o)}return r}(t,e);!function t(e,r,n,o,i,s){var a=e[r.length][n.length];if(-1!=a.value)return a.value;var u=0,c=o(r[r.length-1],n[n.length-1]);c?(u=0,i[r.length-1]=n.length-1,s[n.length-1]=r.length-1):u=1;var f=t(e,r.slice(0,r.length-1),n,o,i,s)+1,h=t(e,r,n.slice(0,n.length-1),o,i,s)+1,l=t(e,r.slice(0,r.length-1),n.slice(0,n.length-1),o,i,s)+u,p=Math.min(f,h,l);return a.value=p,p==f?(a.fromRow=r.length-1,a.fromColumn=n.length):p==h?(a.fromRow=r.length,a.fromColumn=n.length-1):(a.fromRow=r.length-1,a.fromColumn=n.length-1),a.value}(i,t,e,r,n,o);var s=function(t,e,r,n,o){for(var i=r.length,s=e.length,a=[];0!=s||0!=i;){var u=t[s][i];u.fromColumn!=i-1||u.fromRow!=s-1?u.fromColumn!=i||u.fromRow!=s-1?u.fromColumn!=i-1||u.fromRow!=s||(a.push({newValue:r[i-1],state:"new",newValueOrigin:e[o[i-1]]}),i--):(a.push({oldValue:e[s-1],state:"delete",isdeprecated:null==n[s-1]}),s--):(u.value!=t[s-1][i-1].value?a.push({oldValue:e[s-1],isdeprecated:null==n[s-1],state:"replace",newValue:r[i-1],newValueOrigin:e[o[i-1]]}):a.push({oldValue:e[s-1],state:"old",newValue:r[i-1]}),s--,i--)}return a}(i,t,e,n,o);return s.reverse(),s}},"./src/event-center.ts":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={};e.RegisterEvent=function(t,e){n[t]||(n[t]=[]),n[t].push(e)},e.TriggerEvent=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];n[t]&&n[t].forEach(function(t){t.apply(void 0,e)})}},"./src/index.ts":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r("./src/MVVM.ts");e.MVVM=n.MVVM;var o=r("./src/react.ts");e.React=o.default;var i=r("./src/VNode.ts");e.VNode=i.VNode},"./src/react.ts":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r("./src/VNode.ts"),o=r("./src/attribute.ts"),i=new Function("try {return this===window;}catch(e){ return false;}"),s=function(){function t(){this.counter=0,this.mode="deep"}return t.prototype.ResetCounter=function(){this.counter=0},t.prototype.createElement=function(t,e){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var a=[];if(this.flatten("",r,a),"string"==typeof t){var u=new n.VNode("standard");if(u.SetTag(t),i()||(u.SetAttr(o.VNODE_ID,this.counter),this.counter++),null!=e)for(var c in e)u.SetAttr(c,e[c]);return a.forEach(function(t){u.AppendChild(t)}),u}var f=new n.VNode("custom");i()||(f.SetAttr(o.VNODE_ID,this.counter),this.counter++);var h=new t(e);if(f.SetMvvm(h),h.$SetChildren(a),h.$AttachVNode(f),"deep"==this.mode&&h.$DoRender(),null!=e)for(var c in e)f.SetAttr(c,e[c]);return f},t.prototype.flatten=function(t,e,r){var o=this;e.forEach(function(e,i){if(null!=e)if(e instanceof Array)o.flatten(t+i+"_",e,r);else if(e instanceof n.VNode){null!=e.GetAttr("key")?r.push(e):(e.SetAttr("key",t+i),r.push(e))}else{var s=new n.VNode("text");s.SetText(e+""),s.SetAttr("key",t+i),r.push(s)}})},t.prototype.ChangeMode=function(t){this.mode=t},t}();e.default=new s},"./src/refresh.ts":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,o=[],i=[],s=10,a=0;e.InsertQueue=function(t){-1==o.indexOf(t)&&(o.push(t),!n&&o.length>0&&(n=new Promise(function(t,e){t()}).then(function(){i=o,o=[],a=0,function(){for(;;){if(a>s)throw new Error("refresh loop more than "+s);if(a++,i.forEach(function(t){t.$ApplyRefresh()}),0==o.length)break;i=o,o=[]}}(),n=null})))}}})});
//# sourceMappingURL=index.min.js.map